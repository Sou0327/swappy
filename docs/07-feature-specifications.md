# 機能仕様書

## 実装済み機能

### 🔐 認証・ユーザー管理
**現在の実装レベル: 完了**

- **サインアップ/ログイン**: Email + Password
- **ロール管理**: admin, moderator, user
- **セッション管理**: 自動リフレッシュ、永続化
- **認証状態監視**: リアルタイム更新

### 📊 ダッシュボード
**現在の実装レベル: 基本完了**

- **総資産表示**: `user_assets` テーブル集計
- **ユーザー情報**: プロフィール表示
- **クイックアクション**: 入金、取引、セキュリティへの導線
- **レスポンシブレイアウト**: モバイル・デスクトップ対応

### 💰 ウォレット・資産管理
**現在の実装レベル: UI完了、機能部分実装**

#### ウォレット概要 (`/wallet`)
- ✅ 資産一覧表示（`user_assets` から取得）
- ✅ 検索・フィルタリング
- ✅ 小額資産非表示オプション
- ✅ 主要通貨のゼロ残高表示

#### 入金機能 (`/deposit`)
- ✅ コイン・ネットワーク選択UI
- ✅ 受取アドレス表示・QRコード
- ✅ FAQ セクション
- 🔜 フェーズ1実装: Ethereum の ETH/USDT(ERC-20) 入金検知（所定の確認数後に残高反映）
- 🔜 受取アドレス: ユーザー専用EOA（HD払い出し想定）。署名は運用ウォレットで手動。
- ⏸ スイープ/出金: 手動運用（本フェーズは未実装）
- ⏳ BTC/XRP/TRON: 準備中（順次追加）

#### 出金機能 (`/withdraw`)
- ✅ 送金先アドレス入力・バリデーション
- ✅ 金額入力・パーセンテージ選択
- ✅ XRPタグ必須入力対応
- ❌ 実際の送金処理（UIのみ）
- ❌ 手数料計算

### 📈 取引機能（ペーパートレード方針）
**現在の実装レベル: UI完了、データはダミー / 今回フェーズは実取引なし**

#### 取引画面 (`/trade`)
- ✅ 価格チャート（Recharts）
- ✅ オーダーブック表示
- ✅ 売買注文フォーム
- ❌ リアルタイム価格データ
- ❌ 実際の注文処理（本フェーズはシミュレーションで代替）

#### マーケット (`/markets`)
- ✅ 銘柄一覧テーブル
- ✅ 価格・変動率表示
- ❌ 実データ連携

### 💎 稼ぐ機能（Earn）
**現在の実装レベル: UI完了、機能未実装**

#### 稼ぐランディング (`/earn`)
- ✅ ステーキングオプション表示
- ✅ APY・リスク情報
- ✅ 人気プール一覧
- ❌ 実際のステーキング処理

#### 稼ぐ概要 (`/earn-overview`)
- ✅ プロダクト紹介UI
- ✅ 利率バッジ表示
- ❌ 実データ連携

#### 稼ぐ履歴 (`/earn-history`)
- ✅ 履歴テーブルUI
- ✅ 期間フィルター
- ❌ 実データ（プレースホルダーのみ）

### 🔄 両替機能
**現在の実装レベル: UI完了、機能未実装**

#### 通貨両替 (`/convert`)
- ✅ 通貨選択・入れ替えUI
- ✅ レート表示エリア
- ✅ 金額入力フォーム
- ❌ 実際のレート取得
- ❌ 両替処理

### 👥 紹介機能
**現在の実装レベル: UI完了、機能未実装**

#### 紹介プログラム (`/referral`)
- ✅ 紹介リンク・コード表示
- ✅ コピー機能
- ✅ 紹介履歴テーブル（空状態）
- ❌ 紹介コード生成
- ❌ 報酬計算

### 📋 履歴・取引記録
**現在の実装レベル: UI完了、部分実装**

#### 金融履歴 (`/history`)
- ✅ タブ式インターフェース（入金・出金・注文等）
- ✅ フィルター・検索UI
- ❌ 実データ表示（プレースホルダー）

### 🔒 セキュリティ
**現在の実装レベル: UI簡素化**

#### セキュリティ設定 (`/security`)
- ✅ パスワード変更フォーム（動作）
- ✅ アカウント凍結（UI）
- ⏸ 2FA/フィッシング対策コード/回復キー: 本フェーズ対象外（UI非表示）

### 👤 アカウント管理
**現在の実装レベル: 基本情報のみ**

#### マイアカウント (`/my-account`)
- ✅ フルネーム編集（保存動作）
- ⏸ 生年月日・自己紹介: 廃止
- ⏸ 画像アップロード: 非対応（静的アバター）

### 🛠️ 管理機能
**現在の実装レベル: 完了**

#### 管理ダッシュボード (`/admin`)
- ✅ ユーザー管理（`profiles` + `user_roles`）
- ✅ 入金管理（`deposits` 承認・拒否）
- ✅ 出金管理（`withdrawals` 承認・拒否）
- ✅ 資産管理（`user_assets` インライン編集）
- ✅ ロール権限チェック

## 未実装・制限事項（今回の方針反映）

### 🚫 完全に未実装
- KYC機能: 任意（管理画面でON/OFF可能。初期はOFF）
- 実際の暗号資産処理: チェーン別に段階導入（まずEVM入金のみ）
- リアルタイムマーケットデータ: WebSocket連携なし
- 注文マッチングエンジン: 実取引なし（シミュレーションで代替）
- 手数料計算: 入出金・取引手数料は後段
- 通知システム: メール・プッシュ通知
- API レート制限: DoS対策未導入

### ⚠️ 部分実装・改善が必要
- **環境変数未使用**: Supabaseクライアント設定
- **エラーハンドリング**: 統一的なエラー処理
- **ローディング状態**: 一部画面でのUX改善
- **バリデーション**: フォーム検証の強化
- **国際化**: 日本語固定（i18n未導入）

### 🔄 データ連携が必要
- **外部API連携**: 価格データ、マーケット情報
- **ブロックチェーン連携**: ウォレット、トランザクション
- **決済システム連携**: フィアット入金
- **KYC サービス連携**: 本人確認

## 次回開発優先度 (MVP再編：取引所風ウォレット)

参考: 詳細は `docs/09-product-roadmap.md`, `docs/10-exchange-functional-spec.md`

### 🔴 最高優先度 (P0〜P2)
1. 環境変数対応/鍵非保持: セキュリティ是正 (P0)
2. EVM入金の導入: 個別デポジットコントラクト→手動スイープ運用 (P1)
3. 取引UIのシミュレーション整備: 板/注文/履歴の擬似生成・保存 (P2)

### 🟠 高優先度 (P3〜P4)
1. BTC入金: xpub払い出し＋PSBT生成（手動署名）(P3)
2. XRP入金: 単一アドレス＋Destination Tag (P4)
3. エラーハンドリング統一: フロント/API共通ポリシー

### 🟡 中優先度 (P5〜P7)
1. APIキー/署名/レート制限 (P5)
2. 2FA/出金防御（手動運用でも保護強化） (P6)
3. KYC/AML（任意/段階導入） (P7)

### 🟢 低優先度 (P8〜P9)
1. **可観測性/監査** (P8)
2. **国際化/UX整備** (P9)
3. **稼ぐ/紹介等の拡張**

## MVP範囲(抜粋)

- 取引: ペーパートレード（実約定なし）。UIの指値/成行/取消/部分約定は擬似遷移で表現
- 台帳: 入出金/調整の不可変仕訳、残高照会ビュー（取引による資産移動は行わない）
- 入出金: チェーン別段階導入（P1: EVM、P3: BTC、P4: XRP）。承認/反映/履歴は管理画面で手動運用

## 単一マーケット運用
- 未上場トークン1銘柄のみ取引する最小構成に対応。
- 手順は `docs/11-single-market-setup.md` を参照。
