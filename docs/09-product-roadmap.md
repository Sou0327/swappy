# 製品ロードマップ（取引所風ウォレット：公開デモ → 段階拡張）

本書は、「取引所の見え方をしたウォレット（少人数・手動運用）」として最短で公開するための段階的ロードマップです。まずは実取引を行わず（ペーパートレード）、入金のみをチェーン別に段階導入します。

## フェーズ概要

- P0: セキュリティ/設定の是正（鍵非保持・環境分離）
- P1: EVM入金（個別デポジットコントラクト → 手動スイープ）
- P2: 取引UIのシミュレーション整備（板/注文/履歴の擬似生成・保存）
- P3: BTC入金（xpub払い出し + PSBT生成）
- P4: XRP入金（単一アドレス + Destination Tag）
- P5: APIキー/署名/レート制限
- P6: 2FA/出金防御（手動運用でも保護強化）
- P7: KYC/AML（任意/段階導入）
- P8: 可観測性/運用（監査ログ・メトリクス・バックアップ）
- P9: UX整備/国際化/アクセシビリティ

---

## P0 セキュリティ/設定 (必須・先行)

- 目的: 機密情報の管理と環境分離を是正
- タスク:
  - Supabaseキーを環境変数化 (`VITE_SUPABASE_URL`, `VITE_SUPABASE_PUBLISHABLE_KEY`) とリリースキー入替
  - 秘密情報の棚卸しと`.env.example`整備
  - 依存パッケージの脆弱性チェック/アップデート方針
- 受入基準:
  - ビルド/起動が環境変数依存で安定稼働し、鍵の直書きが無い

## P1 全チェーン入金（検知のみ・鍵非保持）

- 目的: 最短で「本当に入る（検知のみ）」を提供（BTC/ETH/XRP/TRON/ADA/USDT）。
- タスク:
  - 各チェーンでユーザー専用受取先の払い出し（ETH/TRON/ADA: HD、BTC: xpub、XRP: 固定+Tag）
  - 入金の取り込み → `deposits` 計上 → 確認数到達で `confirmed` → `user_assets` 反映
  - スイープ/出金は運用時間帯に手動対応（監査ログは記録）
- 受入基準:
  - 各チェーンの少額入金がUI/履歴に反映（ETH/USDT=12, BTC=3〜6, XRP=1, TRON=19, ADA=15 目安）。
  - チェーン受付スイッチと必要確認数が管理画面から調整可能。

## P2 取引UIのシミュレーション整備

- 目的: 実取引なしで“取引所の見え方”を完成
- タスク:
  - 注文ライフサイクルを擬似データで表現（new/open/partially_filled/filled/canceled）
  - 板/歩み値/履歴の擬似生成・保存
  - WS配信（擬似）: `ticker`, `trades`, `orderbook`
- 受入基準:
  - UIが擬似データのみで安定動作し、台帳と矛盾しない（資産移動なし）

## P3 BTC入金

- 目的: BTCでの入金受付
- タスク:
  - xpubからのアドレス払い出し、入金検知、`deposits` 計上
  - PSBT生成（手動署名）と監査ログ
- 受入基準:
  - 少額入金がUI/履歴に反映、スイープ集約が運用可能

## P4 XRP入金

- 目的: XRPでの入金受付
- タスク:
  - 単一アドレス＋Destination Tagでユーザー識別
  - 入金検知、`deposits` 計上
- 受入基準:
  - 入金がUI/履歴に反映、運用が安定

## P5 APIキー/署名/レート制限

- タスク: APIキー発行/失効、HMAC署名、時刻ずれ検証、IP/キー単位レート制限
- 受入基準: 注文/残高のプライベートAPIが実運用可能

## P6 2FA/出金防御

- タスク: TOTP/バックアップコード/強制2FA、アドレス帳・クールダウン
- 受入基準: 出金時の保護が成立

## P7 KYC/AML

- タスク: レベル別KYC、PEP/制裁スクリーニング、疑わしい取引モニタリング(ルール)
- 受入基準: 主要地域での最小コンプライアンスを満たす

## P8 可観測性/運用

- タスク: 構造化ログ/トレース、ビジネスメトリクス、バックアップ/DR、管理者監査ログ(WORM)
- 受入基準: 障害時の原因追跡と復旧手順が運用できる

## P9 UX/国際化

- タスク: リアルタイムUI、エラー/ローディング統一、i18n、A11y、仮想化
- 受入基準: 主要画面のUXが一貫している

---

## スプリント例（最初の3スプリント）

- Sprint 1 (P0+P1): 環境変数対応、全チェーンの入金検知（受取先払い出し・取り込み・履歴反映）
- Sprint 2 (P2): 取引UIのシミュレーション整備、擬似WS配信、履歴保存
- Sprint 3 (P3): BTC入金（xpub/PSBT）と監査ログ

## 公開テストの目安

- フェーズ1（ETH+USDT 入金検知のみ）: 5–7 営業日で公開テスト可能。

## リスク/前提

- サーバは秘密鍵を保持しない（署名は運用側ウォレット）。
- チェーン連携は段階的に導入（まずEVM→BTC→XRP、その他は後段）。
- 将来、自動化や本格的な取引機能へ拡張する場合は別途SOWで定義。
