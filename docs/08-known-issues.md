# 既知の問題点と制限事項

## 🔴 緊急対応が必要な問題

### 1. セキュリティ関連

#### 環境変数未使用 → 対応済み (`src/integrations/supabase/client.ts`)
**対応**: Supabaseクライアントは `.env` の `VITE_SUPABASE_URL` と `VITE_SUPABASE_PUBLISHABLE_KEY` を使用し、未設定時は起動時に検知して失敗させます。`.env.example` を追加しました。
```ts
const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;
```

## 🟠 機能の不整合・バグ

### 1. ルーティングの不整合

#### Earnページのルート構成
**問題**: 
- 仕様書には `/earn-overview` と記載
- 実際のルートは `/earn` が存在し、`EarnOverview.tsx` とは別物
- 混乱を招く命名

**現在の実装**:
- `/earn` → `Earn.tsx` (ステーキングランディング)
- `/earn-overview` → `EarnOverview.tsx` (プロダクト概要)
- `/earn-history` → `EarnHistory.tsx` (履歴)

**推奨**: 命名規則の統一

### 2. データ不整合

#### ダミーデータと実データの混在
**問題**: 
- 一部は実データベースから取得
- 多くの画面でダミーデータ使用
- ユーザーが混乱する可能性

**影響範囲**:
- 取引画面の価格データ
- マーケット情報
- 稼ぐ機能の APY データ

## 🟡 UX/UI の問題

### 1. ローディング状態の不統一

#### 問題箇所
- 認証状態確認中の表示
- データ取得中のスケルトン
- フォーム送信中の状態

**影響**: ユーザー体験の一貫性不足

### 2. エラーハンドリング不足

#### 現在の状況
- ネットワークエラー時の表示不統一
- フォームバリデーションエラーの表示
- 権限エラー時の案内不足

## 🟢 パフォーマンス・最適化

### 1. バンドルサイズ

#### 大きなライブラリ
- `@radix-ui/*` パッケージ群（必要な分のみ）
- `recharts` 全体のインポート
- 未使用のアイコンインポート

**改善案**: Tree-shaking の最適化

### 2. レンダリング最適化

#### 問題点
- Context の過度な再レンダリング
- memo() の未使用
- 大きなリストの仮想化なし

## 📱 レスポンシブ対応の問題

### 1. テーブル表示

#### 問題
- 小画面でのテーブル横スクロール
- 重要な情報の視認性低下
- タッチ操作の困難

**影響画面**:
- 管理画面のテーブル
- 取引履歴
- 資産一覧

### 2. モーダル・ダイアログ

#### 問題
- 小画面でのモーダルサイズ
- キーボード表示時のレイアウト
- スクロール時の位置固定

## 🔧 開発効率の問題

### 1. TypeScript 設定

#### 緩い設定
```typescript
// tsconfig.json の問題
"noImplicitAny": false,
"strictNullChecks": false
```

**影響**: 型安全性の低下、バグの混入

### 2. テスト不足

#### 現状
- ユニットテスト: なし
- E2Eテスト: なし
- 型テスト: なし

**リスク**: リグレッション、品質低下

## 🚫 未実装機能による制限（現フェーズの意図）

### 1. 取引機能制限（仕様）
- 実取引は行わない（ペーパートレード）。orders/trades は擬似データ。
- リアルタイムデータなし（WSは擬似配信に限定）。
- 残高は取引で変動させない（入出金/調整のみ）。
  - 参照: `docs/10-exchange-functional-spec.md`（取引所風ウォレット仕様）

### 2. 入出金機能制限  
- チェーン別に段階導入（P1: EVM、P3: BTC、P4: XRP）。
- 鍵はサーバ非保持、送金は手動署名。
- 一部チェーンは「準備中（入金不可）」を明示。
- 入金監視ワーカー（Edge Functions/外部ワーカー）は未実装（仕様は `12-multichain-deposit-spec.md`）。
  - 参照: `docs/12-multichain-deposit-spec.md`

### 3. マルチチェーン運用上の注意（全チェーン検知時）
- プロバイダのレート制限（TronGrid / Blockfrost / XRPL 公開ノード）
- TRON: Bandwidth/Energy は本フェーズ不要だが将来スイープで必要
- ADA: UTXO 集計の再走タイミングで負荷が増える可能性
- 冪等性: 重複取り込み防止と `confirmations_observed` の増分更新

### 3. セキュリティ機能制限
- 2FA実装なし (UIのみ)
- パスワードリセットなし
- セッションタイムアウトなし

## 📋 対応優先度

### 🔴 最高優先度（即座に対応）
1. **環境変数対応** - セキュリティリスク
2. **統一エラーハンドリング** - UX向上

### 🟠 高優先度（今週中）
1. **TypeScript設定強化** - コード品質
2. **ローディング状態統一** - UX改善
3. **レスポンシブテーブル** - モバイル対応

### 🟡 中優先度（今月中）
1. **テストフレームワーク導入** - 品質保証
2. **パフォーマンス最適化** - ユーザー体験
3. **ルーティング整理** - 開発効率
4. **注文/台帳の不変条件テスト** - 整合性の担保

### 🟢 低優先度（将来）
1. **実機能実装** - プロダクト完成度
2. **国際化対応** - 市場拡大
3. **高度な最適化** - スケール対応

## 🔍 監視すべきメトリクス

### パフォーマンス
- バンドルサイズ
- ページロード時間
- レスポンシブ性能

### エラー率
- 認証エラー
- API呼び出しエラー
- JavaScriptエラー
 - 注文投入/取消/約定の失敗率・リトライ回数

### UX指標
- 離脱率
- 操作完了率
- モバイル利用率
 - リアルタイム更新の遅延・ドリフト
