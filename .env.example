# フェーズ1-2: マルチチェーン入金検知対応 環境変数設定
# Never commit real secrets. These are placeholders.

# =================================
# Supabase設定（必須）
# =================================
# Note: project_id は supabase link --project-ref <id> で設定されるため、ここでは不要
VITE_SUPABASE_PUBLISHABLE_KEY="YOUR_SUPABASE_ANON_KEY"
VITE_SUPABASE_URL="https://YOUR_PROJECT.supabase.co"

# =================================
# EVM チェーン設定（Ethereum系）
# =================================
# いずれかのプロバイダを設定（どちらか片方でOK）
VITE_ALCHEMY_API_KEY="YOUR_ALCHEMY_API_KEY"
VITE_INFURA_PROJECT_ID="YOUR_INFURA_PROJECT_ID"

# ネットワーク設定
VITE_ETHEREUM_NETWORK="sepolia"   # 例: sepolia, mainnet

# ETH 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_ETH=12
VITE_DEPOSIT_ENABLED_ETH=true
VITE_MIN_DEPOSIT_ETH=0.01          # 推奨下限: 0.01〜0.05 ETH

# USDT(ERC-20) 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_USDT=12
VITE_DEPOSIT_ENABLED_USDT=true
VITE_MIN_DEPOSIT_USDT=1.0

# ERC-20 トークンアドレス設定
VITE_USDT_CONTRACT_ADDRESS_MAINNET="0xdac17f958d2ee523a2206206994597c13d831ec7"
VITE_USDT_CONTRACT_ADDRESS_SEPOLIA="0x..."

# =================================
# BTC チェーン設定
# =================================
# BTC API プロバイダー設定（BlockCypher, Blockstream等）
VITE_BTC_API_PROVIDER="blockstream"  # blockstream | blockcypher
VITE_BLOCKCYPHER_API_TOKEN="YOUR_BLOCKCYPHER_TOKEN"

# BTC 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_BTC=3
VITE_DEPOSIT_ENABLED_BTC=false
VITE_MIN_DEPOSIT_BTC=0.0001         # 推奨下限: 0.0001〜0.001 BTC

# BTC ネットワーク
VITE_BTC_NETWORK="testnet"          # mainnet | testnet

# =================================
# XRP チェーン設定
# =================================
# XRP API設定
VITE_XRP_API_PROVIDER="xrpl"       # xrpl | ripple
VITE_XRP_SERVER_URL="wss://s.altnet.rippletest.net:51233"  # testnet

# XRP 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_XRP=1
VITE_DEPOSIT_ENABLED_XRP=false
VITE_MIN_DEPOSIT_XRP=20.0           # 推奨下限: 20〜50 XRP

# XRP固定アドレス（Destination Tag方式）
# ⚠️ XRPアドレスはDBで管理（xrp_fixed_addressesテーブル）
# Supabase SQL Editorで以下のINSERTを実行してください：
# INSERT INTO xrp_fixed_addresses (network, address) VALUES
# ('mainnet', 'rYourMainnetAddress'),
# ('testnet', 'rYourTestnetAddress')
# ON CONFLICT (network, address) DO NOTHING;

# =================================
# TRON チェーン設定  
# =================================
# TRON API設定
VITE_TRON_API_PROVIDER="trongrid"   # trongrid | tronweb
VITE_TRONGRID_API_KEY="YOUR_TRONGRID_API_KEY"

# TRON 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_TRON=19
VITE_DEPOSIT_ENABLED_TRON=false
VITE_MIN_DEPOSIT_TRX=10.0           # 推奨下限: 10〜100 TRX

# USDT(TRC-20) 設定
VITE_DEPOSIT_ENABLED_USDT_TRC=false
VITE_MIN_DEPOSIT_USDT_TRC=1.0

# TRC-20 トークンアドレス
VITE_USDT_TRC20_CONTRACT_ADDRESS="TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"

# =================================
# ADA (Cardano) チェーン設定
# =================================
# Cardano API設定
VITE_ADA_API_PROVIDER="blockfrost"  # blockfrost | cardano-graphql
VITE_BLOCKFROST_PROJECT_ID="YOUR_BLOCKFROST_PROJECT_ID"

# ADA 設定
VITE_DEPOSIT_MIN_CONFIRMATIONS_ADA=15
VITE_DEPOSIT_ENABLED_ADA=false
VITE_MIN_DEPOSIT_ADA=1.0            # 推奨下限: 1〜10 ADA

# ADA ネットワーク
VITE_ADA_NETWORK="testnet"          # mainnet | testnet

# =================================
# ブランディング設定（ホワイトラベル対応）
# =================================
# プラットフォーム名・説明（UIとメールに使用）
VITE_APP_NAME="Your Platform Name"
VITE_APP_TAGLINE="あなたのプラットフォームの説明"
VITE_APP_DOMAIN="yourdomain.com"
VITE_APP_TWITTER="your_twitter"

# =================================
# 機能設定
# =================================
# KYC 任意フラグ（UI/ルート制御用）
VITE_FEATURE_KYC_OPTIONAL=true

# サービス制限モード（システムメンテナンスや緊急時の機能制限）
# 設定値: none（制限なし） | partial（部分制限）
# デフォルト: 未設定またはnone
# 制限内容（partial時）:
#   - 新規ユーザー登録停止
#   - KYC（本人確認）申請停止
#   - 新規入金停止
#   - 管理画面アクセス制限
# 既存ユーザーへの影響:
#   - ログイン機能: 制限なし
#   - 出金機能: 制限なし
#   - 既存資産の取引: 制限なし
# 注: 既存ユーザーの資産保護を最優先とし、重要な機能は常に維持します
VITE_SERVICE_RESTRICTION_MODE="none"

# 単一マーケット運用（オプション）
VITE_SINGLE_MARKET_ID=""

# セキュリティ設定
VITE_FEATURE_2FA_ENABLED=false
VITE_SESSION_TIMEOUT_MINUTES=60

# =================================
# 開発・運用設定
# =================================
# ウォレット暗号化キー（本番環境では必ず変更）
# ⚠️ CRITICAL: ウォレット暗号化キー - 本番環境では必ず強力なキーを環境変数で設定
WALLET_ENCRYPTION_KEY=""

# ログレベル
VITE_LOG_LEVEL="info"              # debug | info | warn | error

# 緊急停止機能（全入金受付を一括停止）
VITE_EMERGENCY_STOP_DEPOSITS=false

# =================================
# 外部サービス設定（オプション）
# =================================
# 価格データAPI（CoinGecko等）
VITE_PRICE_API_PROVIDER="coingecko"
VITE_COINGECKO_API_KEY="YOUR_COINGECKO_API_KEY"

# 通知設定
VITE_NOTIFICATION_ENABLED=false
VITE_WEBHOOK_URL="YOUR_WEBHOOK_URL"

# =================================
# Tatum サブスクリプション管理CLI設定
# =================================
# Tatum API設定（CLI専用）
TATUM_API_KEY="YOUR_TATUM_API_KEY"
TATUM_WEBHOOK_URL="YOUR_SUPABASE_FUNCTION_URL/tatum-webhook"

# Supabase CLI設定（server-side）
SUPABASE_URL="https://YOUR_PROJECT.supabase.co"
SUPABASE_SERVICE_ROLE_KEY="YOUR_SERVICE_ROLE_KEY"

# =================================
# 新規 Edge Function 設定（Phase 0実装）
# =================================
# tatum-subscription-ensure Function（アドレス生成時のサブスクリプション自動作成）
# TATUM_SUBSCRIPTION_ENSURE_TIMEOUT=60000       # タイムアウト（ミリ秒）
# TATUM_SUBSCRIPTION_ENSURE_RETRY_COUNT=3        # リトライ回数

# tatum-admin-status Function（管理画面データ取得）
# TATUM_ADMIN_STATUS_CACHE_TTL=300               # キャッシュTTL（秒）
# TATUM_ADMIN_STATUS_MAX_ERRORS=50               # 取得する最大エラー数

# CLI実行環境設定（Edge Function内でのNode.js/tsx実行）
# TSX_PATH="/usr/local/bin/tsx"                  # tsx実行パス（カスタマイズ可能）
# NODE_PATH="/usr/local/bin/node"                # Node.js実行パス（カスタマイズ可能）
# PROJECT_ROOT="/opt/functions"                  # プロジェクトルートパス（Supabase内）

# =================================
# Webhook署名検証設定
# =================================
# Webhook HMAC署名検証（セキュリティ必須）
TATUM_WEBHOOK_HMAC_SECRET="YOUR_WEBHOOK_HMAC_SECRET_KEY"
TATUM_WEBHOOK_SIGNATURE_ALGORITHM="sha512"

# Webhook エラー処理設定
TATUM_WEBHOOK_RETRY_ATTEMPTS=3
TATUM_WEBHOOK_TIMEOUT_SECONDS=30
TATUM_WEBHOOK_DEAD_LETTER_QUEUE_ENABLED=true

# =================================
# 開発・テスト環境設定
# =================================
# 環境識別
NODE_ENV="development"                    # development | staging | production
VITE_APP_ENV="development"

# ローカル開発用設定
VITE_DEBUG_MODE=true
VITE_MOCK_WEBHOOKS=false                 # テスト用: Webhookをモック化
VITE_SKIP_SIGNATURE_VERIFICATION=false   # ⚠️ 開発時のみ true に設定可能

# テスト用設定
VITE_ENABLE_TEST_ENDPOINTS=true          # テスト用APIエンドポイント有効化
VITE_TEST_WEBHOOK_URL="http://localhost:54321/functions/v1/tatum-webhook"

# デバッグ・監視設定
VITE_ENABLE_PERFORMANCE_MONITORING=false
VITE_VERBOSE_LOGGING=false               # 詳細ログ出力（開発時のみ）
VITE_LOG_WEBHOOK_PAYLOADS=false          # ⚠️ Webhookペイロードのログ出力（開発時のみ）

# =================================
# セキュリティ設定（本番環境）
# =================================
# CORS設定（フロントエンド用）
VITE_ALLOWED_ORIGINS="http://localhost:3000,http://localhost:5173"

# Edge Functions用CORS設定（本番環境で必須）
# ⚠️ .env.example だけでは Edge Functions に反映されない
# 本番: supabase secrets set ALLOWED_ORIGINS="..."
# ローカル: supabase functions serve --env-file .env.local
ALLOWED_ORIGINS="https://yourdomain.com,https://www.yourdomain.com"

# API レート制限
VITE_API_RATE_LIMIT_ENABLED=true
VITE_API_RATE_LIMIT_REQUESTS_PER_MINUTE=100

# SSL/TLS設定（本番環境）
VITE_FORCE_HTTPS=false                   # 本番環境では true に設定
VITE_SSL_CERTIFICATE_PATH=""
VITE_SSL_PRIVATE_KEY_PATH=""

# =================================
# 監視・アラート設定
# =================================
# エラー監視
VITE_ERROR_REPORTING_ENABLED=false
VITE_SENTRY_DSN=""

# アラート設定
VITE_ALERT_WEBHOOK_ERRORS_THRESHOLD=5    # 連続エラー数でアラート
VITE_ALERT_EMAIL=""
VITE_ALERT_SLACK_WEBHOOK=""

# ヘルスチェック設定
VITE_HEALTH_CHECK_INTERVAL_MINUTES=5
VITE_HEALTH_CHECK_ENABLED=true

# =================================
# テスト・検証設定（Phase 0追加）
# =================================
# アドレス生成とサブスクリプション統合テスト
VITE_TEST_ADDRESS_GENERATION=true            # アドレス生成テスト有効化
VITE_TEST_SUBSCRIPTION_INTEGRATION=true      # サブスクリプション統合テスト有効化

# 管理画面機能テスト
VITE_TEST_ADMIN_DASHBOARD=true               # 管理画面テスト有効化
VITE_TEST_WEBHOOK_ERROR_TRACKING=true        # Webhookエラー追跡テスト有効化

# CLI機能テスト
TATUM_CLI_TEST_MODE=false                    # CLI テストモード（本番では false）
TATUM_CLI_DRY_RUN=false                      # ドライランモード（実際の操作なし）

ETHEREUM_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_API_KEY
ETHEREUM_SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_API_KEY

# =================================
# テスト手順ガイド
# =================================
#
# 📋 Phase 0 機能テスト手順:
#
# 1. 環境設定
#    cp .env.example .env.local
#    # 必要な値を設定: TATUM_API_KEY, SUPABASE_*, TATUM_WEBHOOK_HMAC_SECRET
#
# 2. アドレス生成・サブスクリプション統合テスト
#    npm run dev
#    # ブラウザで入金ページにアクセス → アドレス生成 → コンソールでサブスクリプション作成確認
#
# 3. 管理画面テスト
#    # 管理者アカウントでログイン → /admin/wallet → 「更新」ボタンでサブスクリプション状況確認
#
# 4. CLI機能テスト
#    npm run tatum:status    # サブスクリプション状況確認
#    npm run tatum:list      # 一覧表示
#    # テスト用アドレスでのensureコマンドテスト:
#    npx tsx scripts/tatum-subscription-manager.ts ensure 0x1234...abcd evm ethereum ETH
#
# 5. Webhook HMAC署名テスト（別途詳細手順をREADMEに記載）
#    node scripts/generate-hmac.js
#    # 生成されたcurlコマンドでWebhook送信テスト
#
# 6. Edge Function テスト
#    # Supabase CLI起動: npx supabase functions serve --env-file .env.local
#    # tatum-subscription-ensure: アドレス生成時に自動呼び出し
#    # tatum-admin-status: 管理画面「更新」ボタンで呼び出し
#
# ⚠️ セキュリティ注意事項:
# - TATUM_WEBHOOK_HMAC_SECRET は本番環境では必ず強力なランダム値を設定
# - SUPABASE_SERVICE_ROLE_KEY は機密情報のため .env.local に保存（GitHubにコミット禁止）
# - 本番環境では VITE_SKIP_SIGNATURE_VERIFICATION=false を設定（必須）
#
# 🔗 関連ドキュメント:
# - README.md: 基本セットアップ手順
# - scripts/generate-hmac.js: HMAC署名テスト詳細手順
# - supabase/functions/*/index.ts: Edge Function仕様
# - scripts/tatum-subscription-manager.ts: CLI使用方法
